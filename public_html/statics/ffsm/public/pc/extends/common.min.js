layui.config({version:!1,debug:!1,base:"/statics/ffsm/public/pc/extends/"}).extend({calendar:"calendar/calendar.min",datetime:"datetime/datetime.min",zhChinese:"zhChinese.min"}),layui.use(["jquery","zhChinese"],function(){function evaluateConfirmCallback(e,t){var a=e.msg;a.msg&&(a=e.msg.msg),e.code>0?layer.msg(a,{icon:1,time:2e3},function(){$("body").removeClass("base_popup");var e=$("#evaluatePopup");$(document).scrollTop(e.attr("scrolltop")),e.remove()}):e.code<=0&&layer.msg(a,{time:1e3})}var $=layui.jquery,jQuery=layui.jquery,common={protocolTap:function(){if($("#protocolShowBtn").length){var e=$("#protocolPopBox"),t=0;$("#protocolShowBtn").on("click",function(){e.show(),t=$(document).scrollTop(),$("body").addClass("base_popup"),$("body").css("top",-t)}),$("#protocolHideBtn").on("click",function(){$("body").removeClass("base_popup"),$(document).scrollTop(t),e.hide()})}},dateSelect:function(){$(".J_date").length>0&&layui.use("calendar",function(){for(var e=layui.calendar,t=0,a=$(".J_date").length;t<a;t++){(new e).init("#"+$(".J_date").eq(t).attr("id"))}})},genderSelect:function(){var e=$(".J_gender");e.length&&e.children(".J_genderOption").on("click",function(){var e=$(this).data("value");$(this).addClass("active").siblings(".J_genderOption").removeClass("active"),$(this).siblings("input").val(e)})},bindPhoneTap:function(){if($("#bindPhonePopup").length){var e=$("#bindPhonePopup");e.show(),$("body").addClass("base_popup"),$("#bingPhonePopupClose").on("click",function(){$("body").removeClass("base_popup"),e.remove()})}},tabSelect:function(){var e=$(".J_tabTitle");e.length&&e.children(".J_tabTitItem").on("click",function(){$(this).addClass("active").siblings(".J_tabTitItem").removeClass("active");var e=$(this).parent(".J_tabTitle").data("tabconid");$("#"+e).children(".J_tabConItem").eq($(this).index()).show().siblings(".J_tabConItem").hide()})},bottomShowHide:function(){var e=$("#bottomShowHide");if(e.length>0){var t=$("#bottomShowAnchor").length>0?$("#bottomShowAnchor").offset().top:300;return $("body").append('<div id="bottomShowAppend" style="display:none;height:'+e.outerHeight()+'px"></div>'),e.each(function(){$(this);$(window).scroll(function(){$(window).scrollTop()>t?(e.fadeIn(),$("#bottomShowAppend").show()):(e.fadeOut(),$("#bottomShowAppend").hide())})})}},payPopup:function(){var e=$("#payPopupWrapp");if(e.length>0){var t=0;$(".J_payPopupShow").on("click",function(){t=$(document).scrollTop(),$("body").addClass("base_popup"),$("body").css("top",-t),e.show()}),$("#payPopupClose").on("click",function(){$("body").removeClass("base_popup"),$(document).scrollTop(t),e.hide()})}},evaluateTap:function(){if($("#evaluatePopup").length){var e=$("#evaluatePopup"),t=$("#evaluatePopupStar"),a=$("#evaluateStarInput"),o=0;$(window).scroll(function(){var t=$(this).scrollTop(),a=$(document).height();t+$(this).height()+200>=a&&(e.hasClass("active")||(o=$(document).scrollTop(),$("body").addClass("base_popup"),$("body").css("top",-o),e.addClass("active").attr("scrolltop",o).show()))}),t.children(".J_evaluateStar").on("click",function(){for(var e=$(this).index(),o=0;o<5;o++)o<=e?t.children(".J_evaluateStar").eq(o).addClass("on"):t.children(".J_evaluateStar").eq(o).removeClass("on");a.val(e+1)}),$("#evaluatePopupCancel").on("click",function(){$("body").removeClass("base_popup"),$(document).scrollTop(o),e.remove()})}},feedbackTap:function(){var e=$("#feedbackPopupWrap");if(e.length>0){var t=0;$("#feedbackShowBtn").on("click",function(){t=$(document).scrollTop(),$("body").addClass("base_popup"),$("body").css("top",-t),e.show()}),$("#feedbackPopuClose").on("click",function(){$("body").removeClass("base_popup"),$(document).scrollTop(t),e.hide()});var a=$("#feedbackTextarea");$("#feedbackType").change(function(){"0"==$(this).find("option:selected").val()?a.show():a.hide()});$("#contactText");$("#contactType").find("input[name='contact_type']").on("click",function(){$("#contactText").attr("name",$(this).attr("contact_name"))}),layui.use("datetime",function(){(0,layui.datetime)("payDatetime",{theme:"ios",mode:"scroller",display:"bubble",lang:"zh",startYear:(new Date).getFullYear()-2,maxDate:new Date,stepMinute:5})})}},formSubmit:function(){$("form.J_ajaxForm").length&&layui.use(["layer"],function(){var layer=layui.layer,layerLoading,formLock=!1;$(".J_ajaxSubmit").on("click",function(e){if(e.preventDefault(),$("#agreeInput").length&&!$("#agreeInput").is(":checked"))return layer.msg("您未同意个人隐私协议"),!1;if(formLock)return!1;var formBtn=$(this),formElement=formBtn.parents("form.J_ajaxForm"),formValArr=formElement.serializeArray(),callback=function(e,t){var a=e.msg;a.msg&&(a=e.msg.msg),e.code>0?layer.msg(a,{icon:1,time:2e3},function(){e.url&&(window.location.href=e.url)}):e.code<=0&&(layer.msg(a,{time:1e3}),t.removeProp("disabled").removeClass("disabled"))};""!==formBtn.data("callback")&&void 0!=formBtn.data("callback")&&(callback=eval(formBtn.data("callback"))),$.ajax({type:"POST",url:formBtn.data("action")?formBtn.data("action"):formElement.attr("action"),data:formElement.serialize(),dataType:"json",beforeSend:function(e){formLock=!0;var t=formBtn.text();formBtn.attr("textChange")||formBtn.text(t+"中...").prop("disabled",!0).addClass("disabled"),layerLoading=layer.load(0,{shade:!1})},success:function(e){if(e.code>0&&window.localStorage)for(var t=0,a=formValArr.length;t<a;t++)try{localStorage.setItem(formValArr[t].name,formValArr[t].value)}catch(e){}var o=formBtn.text();formBtn.removeClass("disabled").text(o.replace("中...","")),layer.close(layerLoading),callback(e,formBtn),setTimeout(function(){formLock=!1},2e3)}})})})},setLocalStorage:function(){if($("form.J_ajaxForm").length>0)for(var e=$("form.J_ajaxForm").find("input"),t=0,a=e.length;t<a;t++){var o=e.eq(t),n=o.attr("name");if(""!=n&&window.localStorage&&localStorage.getItem(n))switch(!0){case/gender/.test(n):1==localStorage.getItem(n)?o.parent(".J_sex").children("span[data-value=1]").addClass("cur").siblings("span").removeClass("cur"):o.parent(".J_sex").children("span[data-value=0]").addClass("cur").siblings("span").removeClass("cur"),o.val(localStorage.getItem(n));break;case/birthday/.test(n):$("#"+n).attr("data-date",localStorage.getItem(n));break;default:if("true"==o.attr("nolocal"))break;"text"==o.attr("type")&&o.val(localStorage.getItem(n))}}},selectChoice:function(){var e=$(".J_selectChoice");if(e.length>0)for(var t=0,a=e.length;t<a;t++)!function(t){var a=e.eq(t).children(".J_selectChoiceCon");e.eq(t).children("select").on("change",function(){var e=$(this).find("option:selected").text();a.html(e).attr("value",e)})}(t)},init:function(){var e=this;e.selectChoice(),e.protocolTap(),e.dateSelect(),e.genderSelect(),e.bindPhoneTap(),e.evaluateTap(),e.tabSelect(),e.bottomShowHide(),e.feedbackTap(),e.setLocalStorage(),e.formSubmit(),e.payPopup()}};common.init()});